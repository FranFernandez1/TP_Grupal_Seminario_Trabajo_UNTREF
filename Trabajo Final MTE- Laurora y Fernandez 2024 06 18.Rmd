---
title: "Trabajo Práctico Grupal - Seminario Mercado de Trabajo y Empleo"
author: "Melisa Laurora y Francisco Fernández"
date: "2024-06-02"
output:
  html_document:
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Análisis Brasil

::: {align="justify"}
El siguiente trabajo práctico es condición obligatoria para la promoción
de la materia **Mercado de trabajo y empleo de la Maestría en Generación
y Analisis de Información Estadística de la UNTREF**. El mismo es de
resolución grupal.

#### Fecha de entrega:

Martes 18 de junio. La entrega será un informe en Rmarkdown alojado en
un repositorio de Github que pueda correrse desde cualquier computadora,
con la base datos correspondiente en el directorio de trabajo.

## 1 Abrir y explorar las distintas bases de datos. Describir brevemente (en 1 párrafo) la metodología con que la encuesta es elaborada y explicar (en un tabulado) las variables que serán utilizadas en el TP.

```{r warning=FALSE, message = FALSE,include=FALSE}
# librerias
library(tidyverse)
library(ggplot2)
library(kableExtra)

#Cargar base de datos
base<-readRDS(file='Brasil_T32019.Rda')
summary(base)

```

### PNAD Continua - Encuesta Nacional Continua por Muestra de Hogares

Tiene como objetivo principal seguir las fluctuaciones trimestrales y la
evolución en la inserción de la población en el mercado laboral y
características como edad, sexo y nivel de educación, además de permitir
el estudio del desarrollo socioeconómico del país a través de la
producción de datos anuales sobre otras formas de trabajo. Es una
encuesta integrada de viviendas; con muestreo probabilístico; frecuencia
de divulgación trimestral/ anual; población objetivo compuesta por todas
las personas que viven en hogares privados permanentes en el área
cubierta por la investigación (Grandes Regiones, Unidades de Federación,
20 Regiones Metropolitanas que contienen Municipios Capitales,
Municipios de las Capitales y Región de Desarrollo Integrado de la Gran
Teresina).

Fuente:
<https://www.ibge.gov.br/estatisticas/sociais/trabalho/17270-pnad-continua.html?=&t=o-que-e>

```{r}
var<-read.csv("Variables.csv", sep=";",na.strings=c("NA","NULL"),encoding="UTF-8")

var%>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

## 2 Estimar y presentar las tasas básicas del mercado de trabajo. Analizar brevemente los resultados encontrados.

```{r}
if (!require('scales')) install.packages('scales'); library('scales')

Tasas_basicas <- base %>% 
  summarise(Poblacion         = sum(V1028),
            Ocupados          = sum(V1028[VD4002 == "Pessoas ocupadas"],na.rm=TRUE),
            Desocupados       = sum(V1028[VD4002 == "Pessoas desocupadas"],na.rm=TRUE),
            PEA               = Ocupados + Desocupados,
            Subocupados       =  sum(V1028[(VD4004 =="Pessoas subocupadas"|VD4004A=="Pessoas subocupadas")],na.rm=TRUE),
            'Tasa Actividad'                  = percent(PEA/Poblacion, accuracy = 0.1),
            'Tasa Empleo'                     = percent(Ocupados/Poblacion, accuracy = 0.1),
            'Tasa Desocupacion'               = percent(Desocupados/PEA, accuracy = 0.1),
            'Tasa Subocupación'               = percent(Subocupados/PEA, accuracy = 0.1))

#Visualizamos los indicadores básicos de España y Reino Unido
kable(Tasas_basicas, format = "html", table.attr = "class='table table-striped'", caption = "Tasas Básicas del Mercado de Trabajo de Brasil - 2019, 3er trimestre. Fuente: PNAD continua") %>%
  kable_styling(full_width = F, position = "center")

```
Se observa que la tasa de actividad es de un 50,7%, la tasa de empleo 44,7% y la de desocupación 11,8%.



## 3 Realizar una operacionalización de los conceptos de Sector Formal y Sector Informal, de modo de clasificar a toda la población activa en alguno de estos dos sectores. Explicar qué variables se eligieron y por qué.

Se considerará a las personas que se encuentran dentro del sector formal las que cuentan con documentación oficial laboral. Quedarán fuera del sector laboral quienes no cuenten con esto.
Para la construcción del indicador de formalidad, se utilizó la variable VD4029, la cual indaga por la posesión de una cartera o documento de trabajo.
Para los casos de cuentapropistas o empleadores, se consideró la variable V4019, la cual indaga sobre la inscripción al registro nacional de personas jurídicas.

## 4 Realizar una operacionalización del concepto de precariedad laboral, clasificando a toda la población asalariada.

Se considerará trabajadores precarios a quienes sean empleados (del sector público o privado) y tengan un trabajo de tipo temporario. Además, se considerará a quienes sean trabajadores familiares auxiliares. También se considerará a quienes realizan el trabajo en el domicilio del empleador, patron o socio.

Se considerará trabajadores no precarios a quienes sean empleados (del sector público o privado) y tengan un trabajo de tipo permanente. Además, se considerará a quienes sean militares o servidores estatutarios.


## 5 Presentar de forma tabulada la incidencia de la informalidad y la precariedad en la población ocupada y/o asalariada.

```{r}
base<-base %>% mutate(Formalidad = case_when(VD4009 == "Empregado no setor privado com carteira de trabalho assinada"~ "Formal",###Formal
                                             VD4009 == "Empregado no setor privado com carteira de trabalho assinada"~ "Formal",
                                             VD4009 == "Empregado no setor público com carteira de trabalho assinada"~ "Formal",
                                             VD4009 == "Militar e servidor estatutário"~ "Formal",
                                             VD4009 == "Trabalhador doméstico com carteira de trabalho assinada"~ "Formal",
                                             ((VD4009 == "Conta-própria"| VD4009 == "Empregador")&V4019 == "Sim")~ "Formal",
                                             
                                             VD4009 == "Empregado no setor privado sem carteira de trabalho assinada"~ "Informal",###Informal
                                             VD4009 == "Empregado no setor público sem carteira de trabalho assinada"~ "Informal",
                                             VD4009 == "Trabalhador doméstico sem carteira de trabalho assinada"~ "Informal",
                                             VD4009 == "Trabalhador familiar auxiliar"~ "Informal",
                                             ((VD4009 == "Conta-própria"| VD4009 == "Empregador")&V4019 == "Não")~ "Informal"))

Formalidad <- base %>% 
  summarise(Ocupados          = sum(V1028[VD4002 == "Pessoas ocupadas"],na.rm=TRUE),
            Sector_formal= sum(V1028[Formalidad == "Formal"],na.rm=TRUE),
            Sector_informal= sum(V1028[Formalidad == "Informal"],na.rm=TRUE),
            'Tasa Formalidad'= percent(Sector_formal/Ocupados, accuracy = 0.1),
            'Tasa Informalidad'= percent(Sector_informal/Ocupados, accuracy = 0.1))

base<-base %>% mutate(Precariedad = case_when(((VD4009 == "Empregado no setor privado com carteira de trabalho assinada"|
                                                 VD4009 == "Empregado no setor privado com carteira de trabalho assinada"|
                                                 VD4009 == "Empregado no setor público com carteira de trabalho assinada"|
                                                 VD4009 == "Empregado no setor privado sem carteira de trabalho assinada"|
                                                 VD4009 == "Empregado no setor público sem carteira de trabalho assinada")&
                                                 (V4025=="Sim"|V4022=="Em domicílio de empregador, patrão, sócio ou freguês"))~"Precario",
                                              (VD4009 == "Trabalhador familiar auxiliar"|
                                                VD4009 == "Trabalhador doméstico com carteira de trabalho assinada"|
                                              VD4009 == "Trabalhador doméstico sem carteira de trabalho assinada")~"Precario",
                                              ((VD4009 == "Empregado no setor privado com carteira de trabalho assinada"|
                                                 VD4009 == "Empregado no setor público com carteira de trabalho assinada"|
                                                 VD4009 == "Empregado no setor privado sem carteira de trabalho assinada"|
                                                 VD4009 == "Empregado no setor público sem carteira de trabalho assinada")&
                                                (V4025=="Não"))~"No precario",
                                              VD4009 == "Militar e servidor estatutário"~"No precario"))
base<-base %>% mutate(Asalariado = case_when((VD4009 == "Empregado no setor privado com carteira de trabalho assinada"|
                                                 VD4009 == "Empregado no setor público com carteira de trabalho assinada"|
                                                 VD4009 == "Empregado no setor privado sem carteira de trabalho assinada"|
                                                 VD4009 == "Empregado no setor público sem carteira de trabalho assinada"|
                                                VD4009 == "Trabalhador familiar auxiliar"|
                                                VD4009 == "Militar e servidor estatutário"|
                                                VD4009 == "Trabalhador doméstico com carteira de trabalho assinada"|
                                              VD4009 == "Trabalhador doméstico sem carteira de trabalho assinada")~"Asalariado"))

PrecariedadyFormalidad <- base %>% 
  summarise(Asalariados          = sum(V1028[Asalariado == "Asalariado"],na.rm=TRUE),
            Sector_precario= sum(V1028[Precariedad == "Precario"],na.rm=TRUE),
            Sector_no_precario= sum(V1028[Precariedad == "No precario"],na.rm=TRUE),
            'Tasa Precariedad'= percent(Sector_precario/Asalariados, accuracy = 0.1),
            'Tasa No precariedad'= percent(Sector_no_precario/Asalariados, accuracy = 0.1),
            Ocupados          = sum(V1028[VD4002 == "Pessoas ocupadas"],na.rm=TRUE),
            Sector_formal= sum(V1028[Formalidad == "Formal"],na.rm=TRUE),
            Sector_informal= sum(V1028[Formalidad == "Informal"],na.rm=TRUE),
            'Tasa Formalidad'= percent(Sector_formal/Ocupados, accuracy = 0.1),
            'Tasa Informalidad'= percent(Sector_informal/Ocupados, accuracy = 0.1))


#Visualizamos los indicadores básicos de España y Reino Unido
kable(PrecariedadyFormalidad, format = "html", table.attr = "class='table table-striped'", caption = "Tasas de Precariedad e Informalidad del Mercado de Trabajo de Brasil - 2019, 3er trimestre. Fuente: PNAD continua") %>%  kable_styling(full_width = F, position = "center")

```


## 6 Analizar la incidencia de la informalidad y la precariedad según sexo y edad.

```{r}
######Precariedad
if (!require('janitor')) install.packages('janitor'); library('janitor')
if (!require('viridis')) install.packages('viridis'); library('viridis')
PrecariedadxSexo <- base %>%filter(Precariedad=="Precario"|Precariedad=="No precario")%>% group_by(Precariedad,V2007) %>% summarise(n=n())%>% spread(V2007,n) %>%
      adorn_totals(c("row", "col"))  %>%
  adorn_percentages("row") %>%
  adorn_pct_formatting(digits = 1) %>%
  adorn_ns()


kable(PrecariedadxSexo, format = "html", table.attr = "class='table table-striped'", caption = "Tasas de Precariedad e Informalidad del Mercado de Trabajo de Brasil según sexo - 2019, 3er trimestre. Fuente: PNAD continua") %>%
  kable_styling(full_width = F, position = "center")

```


Se observa mayor proporción de precariedad entre el sexo femenino, respecto al masculino.

```{r}
PrecariedadxSexo <- base %>%filter(Precariedad=="Precario"|Precariedad=="No precario")%>% group_by(Precariedad,V2007) %>% summarise(n=n())


ggplot(PrecariedadxSexo, aes(fill=Precariedad, y=n, x=V2007)) + 
    geom_bar(position="fill", stat="identity") + 
    scale_fill_viridis(discrete = T, option = "D")+
  labs(title = "Precariedad laboral por sexo. Población asalariada de 14 años y más. Brasil, 2019",
       x="Sexo",
       y="Proporción")+ theme_minimal()


```

Al diferenciar según edad, se observa mayor proporción de precariedad en menores de 20 y mayores de 75.
```{r}

#### Genero rangos etarios
base$V2009<-as.numeric(base$V2009)
base <-base %>% mutate (GRUPO_EDAD = case_when(V2009 < 5 ~ "00 a 04",
                                               V2009 < 10 ~ "05 a 09",
                                               V2009 < 15 ~ "10 a 14",
                                               V2009 < 20 ~ "15 a 19",
                                               V2009 < 25 ~ "20 a 24",
                                               V2009 < 30 ~ "25 a 29",
                                               V2009 < 35 ~ "30 a 34",
                                               V2009 < 40 ~ "35 a 39",
                                               V2009 < 45 ~ "40 a 44",
                                               V2009 < 50 ~ "45 a 49",
                                               V2009 < 55 ~ "50 a 54",
                                               V2009 < 60 ~ "55 a 59",
                                               V2009 < 65 ~ "60 a 64",
                                               V2009 < 70 ~ "65 a 69",
                                               V2009 < 75 ~ "70 a 74",
                                               V2009 < 80 ~ "75 a 79",
                                               V2009 < 85 ~ "80 a 84",
                                               V2009 < 90 ~ "85 a 89",
                                               V2009 < 95 ~ "90 a 94",
                                               V2009 < 100 ~ "95 a 99",
                                               V2009 <= 130 ~ "100 y más"))

base$GRUPO_EDAD <- factor(base$GRUPO_EDAD, levels = c("00 a 04","05 a 09","10 a 14","15 a 19","20 a 24",
                                                      "25 a 29","30 a 34","35 a 39","40 a 44","45 a 49",
                                                      "50 a 54","55 a 59","60 a 64","65 a 69","70 a 74",
                                                      "75 a 79","80 a 84","85 a 89","90 a 94","95 a 99",
                                                      "100 y más"))
PrecariedadxEdad <- base %>% filter(V2009<100)%>%filter(Precariedad=="Precario"|Precariedad=="No precario")%>% group_by(Precariedad,GRUPO_EDAD) %>% summarise(n=n())%>% spread(Precariedad,n) %>%
    adorn_totals(c("row", "col"))  %>%
  adorn_percentages("row") %>%
  adorn_pct_formatting(digits = 1) %>%
  adorn_ns()

kable(PrecariedadxEdad, format = "html", table.attr = "class='table table-striped'", caption = "Precariedad e Informalidad del Mercado de Trabajo de Brasil según edad  - 2019, 3er trimestre. Fuente: PNAD continua") %>%
  kable_styling(full_width = F, position = "center")

PrecariedadxEdad <- base %>% filter(V2009<100)%>%filter(Precariedad=="Precario"|Precariedad=="No precario")%>% group_by(Precariedad,GRUPO_EDAD) %>% summarise(n=n())
ggplot(PrecariedadxEdad, aes(fill=Precariedad, y=n, x=GRUPO_EDAD)) + 
    geom_bar(position="fill", stat="identity") + 
    scale_fill_viridis(discrete = T, option = "D")+
  labs(title = "Precariedad laboral por sexo. Población asalariada de 14 años y más. Brasil, 2019",
       x="Edad",y="Proporción")+ theme_minimal() +theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

Se observa niveles similares de formalidad entre ambos sexos.

```{r}
######Formalidad
FormalidadxSexo <- base %>%filter(Formalidad=="Formal"|Formalidad=="Informal")%>% group_by(Formalidad,V2007) %>% summarise(n=n())%>% spread(V2007,n) %>%
      adorn_totals(c("row", "col"))  %>%
  adorn_percentages("row") %>%
  adorn_pct_formatting(digits = 1) %>%
  adorn_ns()


kable(FormalidadxSexo, format = "html", table.attr = "class='table table-striped'", caption = "Sector formal y Sector Informal del Mercado de Trabajo según edad. Población Económicamente Activa. Brasil - 2019, 3er trimestre. Fuente: PNAD continua") %>%
  kable_styling(full_width = F, position = "center")
```

Se observan mayores tasas de informalidad en menores de 20 y mayores de 70.

```{r}
FormalidadxEdad <- base %>% filter(V2009<100)%>%filter(Formalidad=="Formal"|Formalidad=="Informal")%>% group_by(Formalidad,GRUPO_EDAD) %>% summarise(n=n())
ggplot(FormalidadxEdad, aes(fill=Formalidad, y=n, x=GRUPO_EDAD)) + 
    geom_bar(position="fill", stat="identity") + 
    scale_fill_viridis(discrete = T, option = "D")+
  labs(title = "Formalidad laboral por sexo. Población Económicamente Activa. Brasil, 2019",
       x="Edad",y="Proporción")+ theme_minimal() +theme(axis.text.x = element_text(angle = 45, hjust = 1))


```





------------------------------------------------------------------------

# Análisis España y Reino Unido


## 1) Abrir y explorar las distintas bases de datos. Describir brevemente la metodología con que la encuesta es elaborada y explicar las variables que serán utilizadas en el TP.


La Encuesta de Fuerza de Trabajo de la Unión Europea (EU-LFS de ahora en más) es la encuesta de hogares e individuos más extensa de la Unión Europea. Su objetivo estadístico principal es clasificar a las personas en tres categorías mutuamente excluyentes: empleados,desempleados y personas por fuera de la fuerza de trabajo. Esta encuesta se realiza de forma trimestral en todos los países de la Unión Europea en un formato estandarizado para todos los países, facilitando así la comparación entre ellos. La población a la cual se le puede realizar la encuesta es de 15 años o más.

Las variables a utilizar, tanto para el caso de España como de Reino Unido, serán las siguentes:

```{r}

Variables <- c("WSTATOR", "MAINSTAT", "COEFF", "STAPRO","SIZEFIRM","TEMP","HWOVERPU","SEEKWORK","AVAILBLE","SIGNISAL","SEX","AGE")
Descripcion <- c("Estado laboral durante la semana de referencia", 
                  "Estado laboral general", 
                  "Factor ponderador de la poblacion", 
                  "Estatus Profesional",
                  "Tamaño de la empresa",
                  "Trabajo Temporal o Permanente",
                  "Cantidad de horas extras no pagas durante la semana de referencia",
                  "En búsqueda laboral",
                  "Disponibilidad para empezar a trabajar en las próximas dos semanas",
                  "Percibe regularmente su salario, aunque no asistió al trabajo en la semana de referencia",
                  "Sexo",
                  "Edad")


variable_table <- data.frame(Variable = Variables, Description = Descripcion)

variable_table %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))

```

## 2) Estimar y presentar las tasas básicas del mercado de trabajo. Analizar brevemente los resultados encontrados.


```{r warning=FALSE}

## Cargamos las bases de datos
bbdd_uk=read.csv("reino_unido.csv")

bbdd_espana=read.csv("espana.csv")

## Calculamos los indicadores básicos laborales para España y Reino Unido

Cuadro_2_ESPAÑA <- bbdd_espana %>% 
  summarise(País="España",
            Poblacion             = sum(COEFF*1000, na.rm = TRUE),
            Ocupados              = sum((WSTATOR %in% c(1,2))*(COEFF*1000),na.rm=TRUE),
            #Ocupados_OIT         = sum((ILOSTAT %in% c(1))*(COEFF*1000),na.rm=TRUE),
            Desocupados           = sum((SEEKWORK %in% c(1,2,4))*(COEFF*1000),na.rm=TRUE),
            #Desocupados_OIT      = sum((ILOSTAT %in% c(2))*(COEFF*1000),na.rm=TRUE),
            #Inactivos   = sum((SEEKWORK %in% c(3)|AVAILBLE %in% c(2))*(COEFF*1000),na.rm=TRUE),
            #Inactivos_OIT        = sum((ILOSTAT %in% c(3))*(COEFF*1000),na.rm=TRUE),
            #Menores              = sum((WSTATOR %in% c(9))*(COEFF*1000),na.rm=TRUE),
            PEA                   = Ocupados + Desocupados,
            'Tasa Actividad'      = percent(PEA/Poblacion, accuracy = 0.1),
            'Tasa Empleo'         = percent(Ocupados/Poblacion, accuracy = 0.1),
            'Tasa Desocupacion'   = percent(Desocupados/PEA, accuracy = 0.1)
            )

Cuadro_2_UK <- bbdd_uk %>% 
  summarise(País="Reino Unido",
            Poblacion             = sum(COEFF*1000, na.rm = TRUE),
            Ocupados              = sum((WSTATOR %in% c(1,2))*(COEFF*1000),na.rm=TRUE),
            #Ocupados_OIT         = sum((ILOSTAT %in% c(1))*(COEFF*1000),na.rm=TRUE),
            Desocupados           = sum((SEEKWORK %in% c(1,2,4))*(COEFF*1000),na.rm=TRUE),
            #Desocupados_OIT      = sum((ILOSTAT %in% c(2))*(COEFF*1000),na.rm=TRUE),
            #Inactivos   = sum((SEEKWORK %in% c(3)|AVAILBLE %in% c(2))*(COEFF*1000),na.rm=TRUE),
            #Inactivos_OIT        = sum((ILOSTAT %in% c(3))*(COEFF*1000),na.rm=TRUE),
            #Menores              = sum((WSTATOR %in% c(9))*(COEFF*1000),na.rm=TRUE),
            PEA                   = Ocupados + Desocupados,
            'Tasa Actividad'      = percent(PEA/Poblacion, accuracy = 0.1),
            'Tasa Empleo'         = percent(Ocupados/Poblacion, accuracy = 0.1),
            'Tasa Desocupacion'   = percent(Desocupados/PEA, accuracy = 0.1)
            )

```



```{r warning=FALSE}

# Agregamos separadores de miles 
Cuadro_2_ESPAÑA <- Cuadro_2_ESPAÑA %>% 
  mutate(across(c(Poblacion, Ocupados, Desocupados, PEA), ~ format(., big.mark = ".", decimal.mark = ",")))

Cuadro_2_UK <- Cuadro_2_UK %>%
  mutate(across(c(Poblacion, Ocupados, Desocupados, PEA), ~ format(., big.mark = ".", decimal.mark = ",")))

# Unificar los datasets
Cuadro_Indicadores_Basicos_Union <- bind_rows(Cuadro_2_ESPAÑA, Cuadro_2_UK)

#Visualizamos los indicadores básicos de España y Reino Unido
kable(Cuadro_Indicadores_Basicos_Union, format = "html", table.attr = "class='table table-striped'", caption = "Tasas Básicas del Mercado de Trabajo de España y Reino Unido - 2018. Fuente: EU LFS 2018-Q1") %>%
  kable_styling(full_width = F, position = "center")

```

Podemos observar que España tiene una tasa de actividad bastante similar a Reino Unido, mientras que encontramos diferencias significativas tanto en la tasa de Desocupación, como en la tasa de Empleo. Pongamos por tanto el foco en la tasa de Desocupación: España tiene 16,1% de desocupación en el período analizado, mientras que Reino Unido tiene 3 veces menos, siendo la tasa de 5%. Asimismo, al hacer una comparación de la tasa de Desocupación de España con Brasil, vemos que la de España también resulta ser ampliamente más alta. Posiblemente más adelante en el trabajo podamos observar si estos niveles de desocupación que observamos en España se explica por algún factor relacionado con la edad o el sexo de las personas.


## 3) Realizar una operacionalización de los conceptos de Sector Formal y Sector Informal, de modo de clasificar a toda la población activa en alguno de estos dos sectores. Explicar qué variables se eligieron y por qué.

Para la operacionalización de los conceptos de Sector Formal e Informal se utilizaron múltiples variables de manera conjunta. Estas variables ya fueron detalladas en el punto 1) de este trabajo. Ahora bien, varias de esas variables se utilizaron en simultáneo para construir distintos conceptos o elementos que, a nuestro entender, dan cuenta del sector en la que se enmarca un trabajador/a. 
En primer lugar, utilizamos la variable SIGNISAL, que refiere a la percepción o no del salario completo cuando el trabajador no asistió al trabajo en la semana de referencia. En los casos que SIGNISAL sea 1,2,3 el trabajador no percibió la totalidad de su salario cuando se ausentó del mismo durante la semana de referencia. Creemos que está es ciertamente una medida para identificar informalidad, aunque también precariedad laboral.

Otras variables de importancia utilizadas para la construcción del indicador de Formalidad/Informalidad laboral fueron STAPRO (Estatus Profesional) y SIZEFIRM (Tamaño de la empresa). Estas variables se utilizaron para identificar a los cuentapropistas. En tal sentido, la variable STAPRO debe equivaler a cero y en simultáneo SIZEFIRM a 99. Consideramos que aquellas personas que trabajan por cuenta propia y no tienen empleados a cargo, dependen exclusivamente de su fuerza de trabajo y sin los beneficios y estabilidad laboral que ofrece, en principio, un trabajo bajo relación de dependencia. Por lo tanto, decidimos incorporarlos dentro del sector informal. Queda claro que, al interior de este sector hay realidades muy variadas, con lo cual no en todos los casos es correcto de hablar de informalidad ciertamente. Pero para los propósitos de este trabajo, lo consideramos como una variable de utilidad para acercarnos al fenómeno de la informalidad.

En definitiva, la construcción del indicador de Informalidad utilizó en simultáneo estos 2 elementos: 1) No percepción del salario completo ante ausencia laboral y 2) Cuentapropistas sin empleados. En el caso de cumplir con una de estas dos condiciones, se decide entonces que el trabajador está en el sector Informal.

En todos los casos, se utilizó el factor de expansión COEFF, y la construcción de estos indicadores es tanto para la base de datos de España como para la de Reino Unido. Es importante mencionar que la EU LPS no tiene preguntas respecto del acceso a la salud o a la educación, a diferencia de buena parte de las encuestas latinoamericanas, con lo cual, el indicador de informalidad debe ser construido con variables de índole distinta a las que uno normalmente buscaría en una encuesta de Mercado de Trabajo.


## 4) Realizar una operacionalización del concepto de precariedad laboral, clasificando a toda la población asalariada.


Para el concepto de precarización laboral, utilizamos en primer lugar la variable HWOVERPU, que captura la cantidad de horas extras trabajadas que no fueron pagadas en la semana de referecia por el empleador. En ese sentido, si ya existía una hora extra no paga, lo contabilizamos como precariedad laboral. A su vez, incorporamos otra variable de suma importancia, TEMP, que remite a los contratos de tipo temporario (TEMP=2). Por último, nos parece importante volver a utilizar una variable que entendemos aplica tanto para precarización como para indicar formalidad de la relación laboral, que es la variable SIGNISAL, que refiere a la percepción o no del salario completo cuando el trabajador no asistió al trabajo en la semana de referencia.Como nuestro denominador vamos a utilizar la variable STAPRO para identificar exclusivamente a los empleados y a los trabajadores familiares (código 3 y 4 respectivamente), dejando por fuera a los cuentapropistas en este caso.

Por lo tanto, para identificar a un trabajador en situación de precariedad laboral, se debe cumplir una de tres condiciones: 1) No haber recibido el pago correspondiente a horas extras trabajadas durante la semana de referencia, 2) Tener un contrato laboral de tipo temporal o 3) No percepción del salario completo ante ausencia laboral.


## 5) Presentar de forma tabulada la incidencia de la informalidad y la precariedad en la población ocupada y/o asalariada.


### Informalidad en España y Reino Unido


```{r warning=FALSE}

## Calculamos la formalidad e informalidad en España 

Cuadro_Formalidad_ESPAÑA <- bbdd_espana %>% 
  summarise( Ocupados              = sum((WSTATOR %in% c(1,2))*(COEFF*1000),na.rm=TRUE),
             No_perciben_salario_completo  = sum((SIGNISAL %in% c(1,2,3))*(COEFF*1000),na.rm=TRUE),
             cuenta_propistas = sum( ((STAPRO == 0)&(SIZEFIRM == 99))  *(COEFF*1000),na.rm=TRUE),
             Salario_Parcial_o_Cuenta_propia_sin_empleados = sum( ((SIGNISAL %in% c(1,2,3)) |((STAPRO == 0)&(SIZEFIRM == 99))    ) * (COEFF * 1000), na.rm = TRUE),
             Informales=Salario_Parcial_o_Cuenta_propia_sin_empleados,
             Formales=Ocupados-Informales,
             'Porcentaje de Informalidad'      = percent(Informales/Ocupados, accuracy = 0.1),
             'Porcentaje de Formalidad'      = percent(Formales/Ocupados, accuracy = 0.1),
             País="España"
            )

## Calculamos la formalidad e informalidad en Reino Unido

Cuadro_Formalidad_Reino_Unido <- bbdd_uk %>% 
  summarise( Ocupados              = sum((WSTATOR %in% c(1,2))*(COEFF*1000),na.rm=TRUE),
             No_perciben_salario_completo  = sum((SIGNISAL %in% c(1,2,3))*(COEFF*1000),na.rm=TRUE),
             cuenta_propistas = sum( ((STAPRO == 0)&(SIZEFIRM == 99))  *(COEFF*1000),na.rm=TRUE),
             Salario_Parcial_o_Cuenta_propia_sin_empleados = sum( ((SIGNISAL %in% c(1,2,3)) | ((STAPRO == 0)&(SIZEFIRM == 99)) ) * (COEFF * 1000), na.rm = TRUE),
             Informales=Salario_Parcial_o_Cuenta_propia_sin_empleados,
             Formales=Ocupados-Informales,
             'Porcentaje de Informalidad'      = percent(Informales/Ocupados, accuracy = 0.1),
             'Porcentaje de Formalidad'      = percent(Formales/Ocupados, accuracy = 0.1),
             País="Reino Unido"
            )


```


```{r warning=FALSE}

# Agregamos separadores de miles 
Cuadro_Formalidad_ESPAÑA <- Cuadro_Formalidad_ESPAÑA %>%
  select(País,Ocupados,Formales,Informales,'Porcentaje de Formalidad','Porcentaje de Informalidad') %>% 
  mutate(across(c(Ocupados,Formales,Informales), ~ format(., big.mark = ".", decimal.mark = ",")))

Cuadro_Formalidad_Reino_Unido <- Cuadro_Formalidad_Reino_Unido %>%
  select(País,Ocupados,Formales,Informales,'Porcentaje de Formalidad','Porcentaje de Informalidad') %>% 
  mutate(across(c(Ocupados,Formales,Informales), ~ format(., big.mark = ".", decimal.mark = ",")))

# Unificar los datasets
Cuadro_Formalidad_Union <- bind_rows(Cuadro_Formalidad_ESPAÑA, Cuadro_Formalidad_Reino_Unido)

#Visualizamos los indicadores adicionales de Formalidad e Informalidad en España y Reino Unido
kable(Cuadro_Formalidad_Union, format = "html", table.attr = "class='table table-striped'", caption = "Indicadores Adicionales del Mercado de Trabajo de España y Reino Unido - 2018. Fuente: EU LFS 2018-Q1") %>%
  kable_styling(full_width = F, position = "center")

```

``` {r warning=FALSE}
library(ggplot2)
library(gridExtra)

# Convertir porcentajes a números sin el símbolo de porcentaje y preparar los datos
data <- Cuadro_Formalidad_Union %>%
  select(País, 'Porcentaje de Formalidad', 'Porcentaje de Informalidad') %>%
  pivot_longer(cols = c('Porcentaje de Formalidad', 'Porcentaje de Informalidad'),
               names_to = "Tipo",
               values_to = "Porcentaje") %>%
  mutate(Porcentaje = as.numeric(gsub("%", "", Porcentaje)))

# Función para crear gráficos de torta con porcentajes dentro de los segmentos
create_pie_chart <- function(df, country) {
  ggplot(df %>% filter(País == country), aes(x = "", y = Porcentaje, fill = Tipo)) +
    geom_bar(stat = "identity", width = 1) +
    coord_polar("y", start = 0) +
    theme_void() +
    ggtitle(paste("Formalidad e Informalidad en", country)) +
    scale_fill_manual(values = c("Porcentaje de Formalidad" = "#B3CDE3", "Porcentaje de Informalidad" = "#FBB4AE")) +
    geom_text(aes(label = paste0(Porcentaje, "%")), position = position_stack(vjust = 0.5)) +  # Mostrar porcentajes dentro de los segmentos
    theme(legend.position = "right",
          plot.title = element_text(size = 12, face = "bold"))  # Ajustar el tamaño del título
}

# Crear los gráficos con porcentajes dentro de los segmentos
pie_chart_espana <- create_pie_chart(data, "España")
pie_chart_reino_unido <- create_pie_chart(data, "Reino Unido")

# Mostrar los gráficos lado a lado
grid.arrange(pie_chart_espana, pie_chart_reino_unido, ncol = 2, widths = c(1.5, 1.5), heights = c(1, 1.2))

```

En  base a la construcción del indicador de formalidad e informalidad laboral en estas bases de datos, podemos observar que ambos países tienen porcentajes relativamente similares en términos de informalidad.Sorprende que Reino Unido tiene un punto porcentual más de porcentaje de Informalidad que España. Por otro lado, en términos absolutos Reino Unido casi duplica a España tanto en cantidad de Ocupados, trabajadores formales e informales, aunque en principio nos interesan más los porcentajes, dado que permiten comparar mejor las formas de trabajo formal e informal entre ambos países. Veamos ahora que sucede con la precarización laboral. Como era de esperar, al comparar la informalidad en un país latinoamericano como Brasil, vemos que la informalidad allí es notablemente mayor, alcanzo niveles del 44,1%, aunque debe quedar claro que se tomaron decisiones metodológicas distintas para medir este país y los europeos.

### Precarización Laboral en España y Reino Unido


```{r warning=FALSE}

## Calculamos la precarización laboral en España 

Cuadro_Precarizacion_ESPAÑA <- bbdd_espana %>% 
  summarise( Empleados              = sum((STAPRO %in% c(3,4))*(COEFF*1000),na.rm=TRUE),
             Temporales             = sum((TEMP == 2 )*(COEFF*1000),na.rm=TRUE),
             Sin_pago_horas_extra   = sum((HWOVERPU >= 1 & HWOVERPU <= 98) * (COEFF * 1000), na.rm = TRUE),
             No_perciben_salario_completo  = sum((SIGNISAL %in% c(1,2,3))*(COEFF*1000),na.rm=TRUE),
             Temporales_o_SinPagoHSEXTRA_sin_salario_completo = sum(((TEMP == 2 )| (HWOVERPU >= 1 & HWOVERPU <= 98) | (SIGNISAL %in% c(1,2,3)))*(COEFF*1000),na.rm=TRUE),
             Precarizados=Temporales_o_SinPagoHSEXTRA_sin_salario_completo,
             No_Precarizados=Empleados-Precarizados,
             'Porcentaje de Precarizados'      = percent(Precarizados/Empleados, accuracy = 0.1),
             'Porcentaje de No Precarizados'   = percent(No_Precarizados/Empleados, accuracy = 0.1),
             País="España"
            )

## Calculamos la precarización laboral en Reino Unido

Cuadro_Precarizacion_Reino_Unido <- bbdd_uk %>% 
  summarise( Empleados              = sum((STAPRO %in% c(3,4))*(COEFF*1000),na.rm=TRUE),
             Temporales             = sum((TEMP == 2 )*(COEFF*1000),na.rm=TRUE),
             Sin_pago_horas_extra   = sum((HWOVERPU >= 1 & HWOVERPU <= 98) * (COEFF * 1000), na.rm = TRUE),
             No_perciben_salario_completo  = sum((SIGNISAL %in% c(1,2,3))*(COEFF*1000),na.rm=TRUE),
             Temporales_o_SinPagoHSEXTRA_sin_salario_completo = sum(((TEMP == 2 )| (HWOVERPU >= 1 & HWOVERPU <= 98) | (SIGNISAL %in% c(1,2,3)))*(COEFF*1000),na.rm=TRUE),
             Precarizados=Temporales_o_SinPagoHSEXTRA_sin_salario_completo,
             No_Precarizados=Empleados-Precarizados,
             'Porcentaje de Precarizados'      = percent(Precarizados/Empleados, accuracy = 0.1),
             'Porcentaje de No Precarizados'   = percent(No_Precarizados/Empleados, accuracy = 0.1),
             País="Reino Unido"
            )

```

```{r warning=FALSE}

# Agregamos separadores de miles 
Cuadro_Precarizacion_ESPAÑA <- Cuadro_Precarizacion_ESPAÑA %>%
  select(País,Empleados,No_Precarizados,Precarizados,'Porcentaje de No Precarizados','Porcentaje de Precarizados') %>% 
  mutate(across(c(Empleados,Precarizados,No_Precarizados), ~ format(., big.mark = ".", decimal.mark = ",")))

Cuadro_Precarizacion_Reino_Unido <- Cuadro_Precarizacion_Reino_Unido %>%
  select(País,Empleados,No_Precarizados,Precarizados,'Porcentaje de No Precarizados','Porcentaje de Precarizados') %>% 
  mutate(across(c(Empleados,Precarizados,No_Precarizados), ~ format(., big.mark = ".", decimal.mark = ",")))

# Unificar los datasets
Cuadro_Precarizacion_Union <- bind_rows(Cuadro_Precarizacion_ESPAÑA, Cuadro_Precarizacion_Reino_Unido)

#Visualizamos los indicadores de Precarización Laboral en España y Reino Unido
kable(Cuadro_Precarizacion_Union, format = "html", table.attr = "class='table table-striped'", caption = "Indicadores de Precarización del Mercado de Trabajo de España y Reino Unido - 2018. Fuente: EU LFS 2018-Q1") %>%
  kable_styling(full_width = F, position = "center")

```

```{r}
# Convertir porcentajes a números sin el símbolo de porcentaje y preparar los datos
data <- Cuadro_Precarizacion_Union %>%
  select(País, 'Porcentaje de No Precarizados', 'Porcentaje de Precarizados') %>%
  pivot_longer(cols = c('Porcentaje de No Precarizados', 'Porcentaje de Precarizados'),
               names_to = "Tipo",
               values_to = "Porcentaje") %>%
  mutate(Porcentaje = as.numeric(gsub("%", "", Porcentaje)))

# Función para crear gráficos de torta con porcentajes dentro de los segmentos
create_pie_chart <- function(df, country) {
  ggplot(df %>% filter(País == country), aes(x = "", y = Porcentaje, fill = Tipo)) +
    geom_bar(stat = "identity", width = 1) +
    coord_polar("y", start = 0) +
    theme_void() +
    ggtitle(paste("Precarización Laboral en", country)) +
    scale_fill_manual(values = c("Porcentaje de No Precarizados" = "#B3CDE3", "Porcentaje de Precarizados" = "#FBB4AE")) +
    geom_text(aes(label = paste0(Porcentaje, "%")), position = position_stack(vjust = 0.5)) +  # Mostrar porcentajes dentro de los segmentos
    theme(legend.position = "right",
          plot.title = element_text(size = 12, face = "bold"))  # Ajustar el tamaño del título
}

# Crear los gráficos con porcentajes dentro de los segmentos
pie_chart_espana <- create_pie_chart(data, "España")
pie_chart_reino_unido <- create_pie_chart(data, "Reino Unido")

# Mostrar los gráficos lado a lado
grid.arrange(pie_chart_espana, pie_chart_reino_unido, ncol = 2, widths = c(1.5, 1.5), heights = c(1, 1.2))
```

Analizando la precarización laboral en ambos países, ahora sí es posible ver diferencias más notorias, que a su vez van en la línea con lo esperado. En ese sentido, vemos que el porcentaje de Precarizados en España es notablemente mayor que en el Reino Unido, de hecho es casi 50% mayor. Nuevamente, en términos absolutos Reino Unido duplica a España en Empleados y No Precarizados, pero claro ya no en cantidad de personas precarizadas, siendo los números casi similares en términos absolutos. Por otro lado, es notable que en Brasil el porcentaje de precarizados es bastante similar al de Reino Unido, aunque este es algo menor. A su vez, en comparación con España, Brasil tiene un porcentaje significativamente mejor de precarizados. Como ya sabemos, tenemos que tener en cuenta que los criterios utilizados para medir precarización en los dos países europeos difiere mucho del utilizado en el capítulo de Brasil.


## 6 Analizar la incidencia de la informalidad y la precariedad según sexo y edad.

En primer lugar construimos las pirámides poblacionales de ambos países para tener una idea inicial de sus estructuras poblacionales por edad y género.

```{r warning=FALSE}

## Cálculo de datos para Pirámide Poblacional de España

# Transformar los valores de SEX a "Hombre" y "Mujer"
bbdd_espana2 <- bbdd_espana %>%
  mutate(Sexo = ifelse(SEX == 1, "Hombre", "Mujer"))

# Crear intervalos de edad en la base de datos
bbdd_espana2 <- bbdd_espana2 %>%
  mutate(Edad_Grupo = cut(AGE, breaks = seq(0, 100, by = 10), right = FALSE, labels = c("0-9", "10-19", "20-29", "30-39", "40-49", "50-59", "60-69", "70-79", "80-89", "90+")))

# Asegurar que Edad_Grupo es un factor
bbdd_espana2$Edad_Grupo <- as.factor(bbdd_espana2$Edad_Grupo)

# Agrupar los datos por intervalos de edad y sexo considerando el factor de expansión
edad_sexo <- bbdd_espana2 %>%
  group_by(Edad_Grupo, Sexo) %>%
  summarise(Count = sum(COEFF * 1000, na.rm = TRUE)) %>%
  ungroup()



# Crear gráfico de pirámide poblacional de España
ggplot(data = edad_sexo, aes(x = Edad_Grupo, y = ifelse(Sexo == "Hombre", -Count, Count), fill = Sexo)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  scale_y_continuous(labels = function(x) format(abs(x), big.mark = ".", decimal.mark = ".", scientific = FALSE)) +
  labs(y = "Cantidad de Personas", x = "Grupo de Edad", title = "Pirámide Poblacional por Edad y Género en España") +
  theme_minimal() +
  scale_fill_manual(values = c("Hombre" = "#77dd77", "Mujer" = "#cba0dc"))


```
```{r warning=FALSE}

## Cálculo de datos para Pirámide Poblacional de Reino Unido

# Transformar los valores de SEX a "Hombre" y "Mujer"
bbdd_uk2 <- bbdd_uk %>%
  mutate(Sexo = ifelse(SEX == 1, "Hombre", "Mujer"))

# Crear intervalos de edad en la base de datos
bbdd_uk2 <- bbdd_uk2 %>%
  mutate(Edad_Grupo = cut(AGE, breaks = seq(0, 100, by = 10), right = FALSE, labels = c("0-9", "10-19", "20-29", "30-39", "40-49", "50-59", "60-69", "70-79", "80-89", "90+")))

# Asegurar que Edad_Grupo es un factor
bbdd_uk2$Edad_Grupo <- as.factor(bbdd_uk2$Edad_Grupo)

# Agrupar los datos por intervalos de edad y sexo considerando el factor de expansión
edad_sexo_uk <- bbdd_uk2 %>%
  group_by(Edad_Grupo, Sexo) %>%
  summarise(Count = sum(COEFF * 1000, na.rm = TRUE)) %>%
  ungroup()

# Crear gráfico de pirámide poblacional de Reino Unido
ggplot(data = edad_sexo_uk, aes(x = Edad_Grupo, y = ifelse(Sexo == "Hombre", -Count, Count), fill = Sexo)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  scale_y_continuous(labels = function(x) format(abs(x), big.mark = ".", scientific = FALSE)) +
  labs(y = "Cantidad de Personas", x = "Grupo de Edad", title = "Pirámide Poblacional por Edad y Género en Reino Unido") +
  theme_minimal() +
  scale_fill_manual(values = c("Hombre" = "#77dd77", "Mujer" = "#cba0dc"))

```

Podemos observar que España tiene una parte significativa de su población entre los 30 y los 60 años, es decir en su edad económicamente activa. Aunque también es posible afirmar que tiene una población bastante envejecida al analizar la cantidad de personas mayores a 70 años, no deja de llamar la atención que una parte significativa de su población, las barras más importantes de la pirámide población se encuentran en el medio de la pirámide, lo cual resulta algo sorpresivo para un país europeo. Esto puede deberse a una multiplicidad de factores como la inmigración, que no vienen al caso para este trabajo. 

Por otra parte, la pirámide poblacional de Reino Unido nos revela una típica población envejecida, con una forma de cóncava o de bala, donde a su vez una parte muy importante de su población se encuentra cerca o ya en estado inactivo por su edad.

Ahora bien, pasemos a analizar la incidencia de la informalidad y la precariedad laboral en estas poblaciones.


```{r}

## Transformamos las variables Sexo y Edad

bbdd_espana3 <- mutate(bbdd_espana,
                      Edad_Periodo = cut(AGE,
                                         breaks = c(15, 30, 45, 60, Inf),
                                         labels = c("15-30", "30-45", "45-60", "60 o más"),
                                         include.lowest = TRUE))%>%
  filter(!is.na(Edad_Periodo))  

bbdd_espana3 <- bbdd_espana3 %>%
  mutate(Sexo = case_when(
    SEX == 1 ~ "Hombre",
    SEX == 2 ~ "Mujer",
    TRUE ~ as.character(SEX)  
  ))

## Calculamos la informalidad por Sexo y Edad
Cuadro_Formalidad_ESPAÑA2 <- bbdd_espana3 %>% 
  group_by(Edad_Periodo, Sexo) %>%  # Agrupar por edad y sexo
  summarise(
    Ocupados = sum((WSTATOR %in% c(1, 2)) * (COEFF * 1000), na.rm = TRUE),
    No_perciben_salario_completo = sum((SIGNISAL %in% c(1, 2, 3)) * (COEFF * 1000), na.rm = TRUE),
    cuenta_propistas = sum(((STAPRO == 0) & (SIZEFIRM == 99)) * (COEFF * 1000), na.rm = TRUE),
    Salario_Parcial_o_Cuenta_propia_sin_empleados = sum(((SIGNISAL %in% c(1, 2, 3)) | ((STAPRO == 0) & (SIZEFIRM == 99))) * (COEFF * 1000), na.rm = TRUE),
    Informales = Salario_Parcial_o_Cuenta_propia_sin_empleados,
    Formales = Ocupados - Informales,
    'Porcentaje de Informalidad' = percent(Informales / Ocupados, accuracy = 0.1),
    'Porcentaje de Formalidad' = percent(Formales / Ocupados, accuracy = 0.1),
    País = "España"
  )

# Formatear y redondear las columnas
Cuadro_Formalidad_ESPAÑA2 <- Cuadro_Formalidad_ESPAÑA2 %>%
  select(País, Edad_Periodo, Sexo, Ocupados, Formales, Informales, 'Porcentaje de Formalidad', 'Porcentaje de Informalidad') %>% 
  mutate(
    across(c(Ocupados, Formales, Informales), ~ round(., digits = 0)),  # Redondear a enteros
    across(c(Ocupados, Formales, Informales), ~ format(., big.mark = ".", decimal.mark = ","))
  )

# Visualizar los indicadores en formato HTML
kable(Cuadro_Formalidad_ESPAÑA2, format = "html", table.attr = "class='table table-striped'", caption = "Indicadores de Formalidad e Informalidad del Mercado de Trabajo de España según Sexo y Edad - 2018. Fuente: EU LFS 2018-Q1") %>%
  kable_styling(full_width = F, position = "center")

```


Del cuadro anterior es posible extraer que en España el porcentaje de Informalidad tiene a ser mayor para los hombres que para las mujeres. A su vez, en la medida que aumenta la edad, la informalidad tiende a crecer de manera de constante para ambos sexos. De tal forma que, por ejemplo, mientras la informalidad para Hombres y Mujeres de los 15 a los 30 años es de 11,2% y 7,4% respectivamente, en el rango de edades de 60 o más estos números más que se duplican pasando al 25,2% en los hombres y al 20,8% para las mujeres. Veamos qué sucede con el Reino Unido. 



```{r}

## Transformamos las variables Sexo y Edad

bbdd_uk3 <- mutate(bbdd_uk,
                      Edad_Periodo = cut(AGE,
                                         breaks = c(15, 30, 45, 60, Inf),
                                         labels = c("15-30", "30-45", "45-60", "60 o más"),
                                         include.lowest = TRUE))%>%
  filter(!is.na(Edad_Periodo))  

bbdd_uk3 <- bbdd_uk3 %>%
  mutate(Sexo = case_when(
    SEX == 1 ~ "Hombre",
    SEX == 2 ~ "Mujer",
    TRUE ~ as.character(SEX)  
  ))

## Calculamos la informalidad por Sexo y Edad
Cuadro_Formalidad_UK2 <- bbdd_uk3 %>% 
  group_by(Edad_Periodo, Sexo) %>%  # Agrupar por edad y sexo
  summarise(
    Ocupados = sum((WSTATOR %in% c(1, 2)) * (COEFF * 1000), na.rm = TRUE),
    No_perciben_salario_completo = sum((SIGNISAL %in% c(1, 2, 3)) * (COEFF * 1000), na.rm = TRUE),
    cuenta_propistas = sum(((STAPRO == 0) & (SIZEFIRM == 99)) * (COEFF * 1000), na.rm = TRUE),
    Salario_Parcial_o_Cuenta_propia_sin_empleados = sum(((SIGNISAL %in% c(1, 2, 3)) | ((STAPRO == 0) & (SIZEFIRM == 99))) * (COEFF * 1000), na.rm = TRUE),
    Informales = Salario_Parcial_o_Cuenta_propia_sin_empleados,
    Formales = Ocupados - Informales,
    'Porcentaje de Informalidad' = percent(Informales / Ocupados, accuracy = 0.1),
    'Porcentaje de Formalidad' = percent(Formales / Ocupados, accuracy = 0.1),
    País = "Reino Unido"
  )

# Formatear y redondear las columnas
Cuadro_Formalidad_UK2 <- Cuadro_Formalidad_UK2 %>%
  select(País, Edad_Periodo, Sexo, Ocupados, Formales, Informales, 'Porcentaje de Formalidad', 'Porcentaje de Informalidad') %>% 
  mutate(
    across(c(Ocupados, Formales, Informales), ~ round(., digits = 0)),  # Redondear a enteros
    across(c(Ocupados, Formales, Informales), ~ format(., big.mark = ".", decimal.mark = ","))
  )

# Visualizar los indicadores en formato HTML
kable(Cuadro_Formalidad_UK2, format = "html", table.attr = "class='table table-striped'", caption = "Indicadores de Formalidad e Informalidad del Mercado de Trabajo de Reino Unido según Sexo y Edad - 2018. Fuente: EU LFS 2018-Q1") %>%
  kable_styling(full_width = F, position = "center")

```

Al igual que en el caso de España, los hombres en Reino Unido tienden a tener un nivel de informalidad más alto que las mujeres en todos los grupos de edad. Y también muy en línea con lo que vimos para España, en Reino Unido la edad también es un factor clave para entender el fenómeno de la informalidad. Al aumentar la edad la informalidad crece, y de forma mucho más marcada que en el caso español. Retomando un ejemplo similar, en el grupo de edad de 15 a 30 la informalidad para hombres es de 10,9% y de 7,3% para las mujeres (nótese la similitud de los porcentajes con España). Ahora bien, al analizar el grupo de edad mayor (60 o más años) la informalidad se triplica para ambos géneros: pasa al 32,1% en Hombres y al 21,7% en mujeres. Por otra parte, comparando contra Brasil, vemos que la informalidad también parece afectar de manera diferencial a los hombres por sobre las mujeres, aunque de una manera menos marca que como notamos en los países europeos. En ese sentido, parece ser que la informalidad es un fenómeno más extendido en el país latinoamericano, pero la variable sexo no parece afectar tanto como lo hace en España y Reino Unido.

Analicemos por último el fenómeno de la precariedad laboral.

```{r}

## Calculamos la precariedad laboral por Sexo y Edad para España

Cuadro_Precarizacion_ESPAÑA3 <- bbdd_espana3 %>% 
  group_by(Edad_Periodo, Sexo) %>%  # Agrupar por edad y sexo
  summarise(
    Empleados = sum((STAPRO %in% c(3,4)) * (COEFF * 1000), na.rm = TRUE),
    Temporales = sum((TEMP == 2) * (COEFF * 1000), na.rm = TRUE),
    Sin_pago_horas_extra = sum((HWOVERPU >= 1 & HWOVERPU <= 98) * (COEFF * 1000), na.rm = TRUE),
    No_perciben_salario_completo = sum((SIGNISAL %in% c(1,2,3)) * (COEFF * 1000), na.rm = TRUE),
    Temporales_o_SinPagoHSEXTRA_sin_salario_completo = sum(((TEMP == 2) | (HWOVERPU >= 1 & HWOVERPU <= 98) | (SIGNISAL %in% c(1,2,3))) * (COEFF * 1000), na.rm = TRUE),
    Precarizados = Temporales_o_SinPagoHSEXTRA_sin_salario_completo,
    No_Precarizados = Empleados - Precarizados,
    'Porcentaje de Precarizados' = percent(Precarizados / Empleados, accuracy = 0.1),
    'Porcentaje de No Precarizados' = percent(No_Precarizados / Empleados, accuracy = 0.1),
    País = "España"
  ) %>%
  mutate(
    across(where(is.numeric), ~ ifelse(is.na(.), 0, .)),  # Manejo de NA (si aplica)
    across(c(Empleados,Precarizados, No_Precarizados), ~ round(., digits = 0)),  # Redondear a enteros
    across(c(Empleados,Precarizados, No_Precarizados), ~ format(., big.mark = ".", decimal.mark = ","))  # Formatear números
  ) %>%
  select(País, Edad_Periodo, Sexo, Empleados, No_Precarizados, Precarizados, 'Porcentaje de No Precarizados', 'Porcentaje de Precarizados')


# Visualizar los indicadores en formato HTML
kable(Cuadro_Precarizacion_ESPAÑA3, format = "html", table.attr = "class='table table-striped'", caption = "Indicadores de Precarización del Mercado de Trabajo de España según Sexo y Edad - 2018. Fuente: EU LFS 2018-Q1") %>%
  kable_styling(full_width = F, position = "center")


```

Ahora bien, a la hora de analizar la precarización laboral, lo que notamos en primer lugar es que las mujeres tienden a tener un porcentaje más elevado, lo cual es justamente lo contrario a lo que notamos con la informalidad laboral. Asimismo, la variable de edad vuelve a tener un rol preponderante, aunque esta vez de forma inversa a lo que notamos con la informalidad. En este caso, la precarización laboral afecta de manera mucho más fuerte a los jóvenes y a medida que aumenta la edad se reduce notablemente la precarización. A modo de ejemplo, mientras que la precarización es de 60,8% y de 57,8% para mujeres y hombres de 15 a 30 (respectivamente), la misma se reduce a un tercio en el rango de edad más alto (pasa a 19,4% en mujeres y 17,2% en hombres). En este sentido, el fenómeno de la precarización en España afecta de manera notablemente fuerte a los jóvenes, y sobre todo a las mujeres jóvenes. Pasemos al caso de Reino Unido.


```{r}

## Calculamos la precariedad laboral por Sexo y Edad para Reino Unido

Cuadro_Precarizacion_UK3 <- bbdd_uk3 %>% 
  group_by(Edad_Periodo, Sexo) %>%  # Agrupar por edad y sexo
  summarise(
    Empleados = sum((STAPRO %in% c(3,4)) * (COEFF * 1000), na.rm = TRUE),
    Temporales = sum((TEMP == 2) * (COEFF * 1000), na.rm = TRUE),
    Sin_pago_horas_extra = sum((HWOVERPU >= 1 & HWOVERPU <= 98) * (COEFF * 1000), na.rm = TRUE),
    No_perciben_salario_completo = sum((SIGNISAL %in% c(1,2,3)) * (COEFF * 1000), na.rm = TRUE),
    Temporales_o_SinPagoHSEXTRA_sin_salario_completo = sum(((TEMP == 2) | (HWOVERPU >= 1 & HWOVERPU <= 98) | (SIGNISAL %in% c(1,2,3))) * (COEFF * 1000), na.rm = TRUE),
    Precarizados = Temporales_o_SinPagoHSEXTRA_sin_salario_completo,
    No_Precarizados = Empleados - Precarizados,
    'Porcentaje de Precarizados' = percent(Precarizados / Empleados, accuracy = 0.1),
    'Porcentaje de No Precarizados' = percent(No_Precarizados / Empleados, accuracy = 0.1),
    País = "Reino Unido"
  ) %>%
  mutate(
    across(where(is.numeric), ~ ifelse(is.na(.), 0, .)),  # Manejo de NA (si aplica)
    across(c(Empleados,Precarizados, No_Precarizados), ~ round(., digits = 0)),  # Redondear a enteros
    across(c(Empleados,Precarizados, No_Precarizados), ~ format(., big.mark = ".", decimal.mark = ","))  # Formatear números
  ) %>%
  select(País, Edad_Periodo, Sexo, Empleados, No_Precarizados, Precarizados, 'Porcentaje de No Precarizados', 'Porcentaje de Precarizados')


# Visualizar los indicadores en formato HTML
kable(Cuadro_Precarizacion_UK3, format = "html", table.attr = "class='table table-striped'", caption = "Indicadores de Precarización del Mercado de Trabajo de Reino Unido según Sexo y Edad - 2018. Fuente: EU LFS 2018-Q1") %>%
  kable_styling(full_width = F, position = "center")



```

En el caso del Reino Unido, vemos que la precarización es algo más elevada para las mujeres en el rango de 15-30 años y de 45-60 años, mientras que es bastante pareja para ambos sexos en los otros rangos etarios. Por otro parte, y muy a diferencia de España, la precarización afecta en menor medida a los jóvenes de 15 a 30 años, que en los demás rangos etarios, con la excepción del rango etario de 60 o más años. De todas formas, lo que queda claro es que la precarización es notablemente más baja en todos los rangos etarios y que varía considerablemente poco, en relación a España. Con lo cual, es posible afirmar que la precarización laboral en Reino Unido es un problema notablemente menos significativo que en España, no afecta de manera tan fuerte a jóvenes y mujeres, como sí sucede en el caso de España. Por último, al comparar con Brasil, en primer lugar es posible notar que la precarización también afecta de manera más profunda a las mujeres y al sector más joven. Por otra parte, en Brasil, a diferencia de España, los niveles de precarización son muy altos en la juventud, bajan fuertemente en la mediana edad o adultez, y por último vuelven a subir en los últimos años de actividad de las personas.
